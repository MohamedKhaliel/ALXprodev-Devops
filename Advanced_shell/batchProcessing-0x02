#!/bin/bash

# List of Pokémon to fetch
Pokemon_list=("Bulbasaur" "Ivysaur" "Venusaur" "Charmander" "Charmeleon")

# API endpoint
API_URL="https://pokeapi.co/api/v2/pokemon"

# Loop through each Pokémon
for POKEMON in "${POKEMONS[@]}"; do
    FILE_NAME=$(echo "$POKEMON" | tr '[:upper:]' '[:lower:]').json

    echo "Fetching data for $POKEMON..."

    # Retry logic (max 3 attempts)
    ATTEMPTS=0
    SUCCESS=false

    while [ $ATTEMPTS -lt 3 ]; do
        # Fetch Pokémon data
        RESPONSE=$(curl -s -w "%{http_code}" -o "$FILE_NAME" "$API_URL/$(echo "$POKEMON" | tr '[:upper:]' '[:lower:]')")

        HTTP_CODE=${RESPONSE: -3}

        if [ "$HTTP_CODE" -eq 200 ]; then
            echo "✅ Successfully saved $POKEMON data to $FILE_NAME"
            SUCCESS=true
            break
        else
            echo "⚠️ Failed to fetch $POKEMON (HTTP $HTTP_CODE). Retrying..."
            ATTEMPTS=$((ATTEMPTS + 1))
            sleep 1
        fi
    done

    if [ "$SUCCESS" = false ]; then
        echo "❌ Could not fetch $POKEMON after 3 attempts. Skipping..."
        # Remove incomplete file if exists
        [ -f "$FILE_NAME" ] && rm "$FILE_NAME"
    fi
done
